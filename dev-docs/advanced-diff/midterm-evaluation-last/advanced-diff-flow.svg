<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1400"><rect x="0" y="0" width="1200" height="1400" fill="#f9fafc"></rect><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#555"></path></marker><marker id="parity-dot" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6"><circle cx="5" cy="5" r="3" fill="#7f7f7f"></circle></marker></defs><text x="600" y="60" text-anchor="middle" font-size="32" font-weight="600" fill="#1a2b4c">VS Code Advanced Diff · Pipeline Parity Snapshot</text><text x="600" y="92" text-anchor="middle" font-size="16" fill="#3c4f76">Vertical lanes compare line-level and char-level flows in VS Code vs. C port</text><g class="lane" transform="translate(70,0)"><text x="125" y="70" text-anchor="middle" font-size="20" font-weight="600" fill="#1f4f82">VS Code · Line-Level</text><line x1="125" x2="125" y1="80" y2="1300" stroke="#d0d7e5" stroke-width="2" stroke-dasharray="6,6"></line><g class="step" transform="translate(5,120)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Perfect hash</tspan><tspan x="120" dy="18">per trimmed line</tspan></text></g><g class="step" transform="translate(5,250)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">DP / ND selection</tspan><tspan x="120" dy="18">(timeout aware)</tspan></text></g><g class="step" transform="translate(5,380)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Heuristic Step 2:</tspan><tspan x="120" dy="18">optimizeSequenceDiffs</tspan></text></g><g class="step" transform="translate(5,510)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Heuristic Step 3:</tspan><tspan x="120" dy="18">removeVeryShortMatchingLines</tspan></text></g><g class="step" transform="translate(5,640)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Output SequenceDiff[]</tspan></text></g></g><g class="lane" transform="translate(390,0)"><text x="125" y="70" text-anchor="middle" font-size="20" font-weight="600" fill="#1f4f82">VS Code · Char-Level</text><line x1="125" x2="125" y1="80" y2="1300" stroke="#d0d7e5" stroke-width="2" stroke-dasharray="6,6"></line><g class="step" transform="translate(5,120)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Range mapping ➜</tspan><tspan x="120" dy="18">LinesSliceCharSequence</tspan></text></g><g class="step" transform="translate(5,250)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">DP / ND char diff</tspan></text></g><g class="step" transform="translate(5,380)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">optimizeSequenceDiffs</tspan></text></g><g class="step" transform="translate(5,510)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">extendDiffsToEntireWord</tspan><tspan x="120" dy="18">(+subword option)</tspan></text></g><g class="step" transform="translate(5,640)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">removeShortMatches</tspan></text></g><g class="step" transform="translate(5,770)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">removeVeryShortMatchingText</tspan></text></g><g class="step" transform="translate(5,900)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Translate to RangeMapping</tspan><tspan x="120" dy="18">+ propagate hitTimeout</tspan></text></g><g class="step" transform="translate(5,1030)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">Whitespace scan between</tspan><tspan x="120" dy="18">line segments</tspan></text></g></g><g class="lane" transform="translate(710,0)"><text x="125" y="70" text-anchor="middle" font-size="20" font-weight="600" fill="#1f4f82">C Port · Line-Level</text><line x1="125" x2="125" y1="80" y2="1300" stroke="#d0d7e5" stroke-width="2" stroke-dasharray="6,6"></line><g class="step" transform="translate(5,120)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">string_hash_map +</tspan><tspan x="120" dy="18">line_sequence_create</tspan></text></g><g class="step" transform="translate(5,250)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">myers_dp / myers_nd</tspan><tspan x="120" dy="18">selection</tspan></text></g><g class="step" transform="translate(5,380)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">optimize_sequence_diffs</tspan></text></g><g class="step" transform="translate(5,510)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">remove_very_short_matching</tspan><tspan x="120" dy="18">_lines_between_diffs</tspan></text></g><g class="step" transform="translate(5,640)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">SequenceDiffArray result</tspan></text></g></g><g class="lane" transform="translate(1030,0)"><text x="125" y="70" text-anchor="middle" font-size="20" font-weight="600" fill="#b85c00">C Port · Char-Level &amp; Render</text><line x1="125" x2="125" y1="80" y2="1300" stroke="#d0d7e5" stroke-width="2" stroke-dasharray="6,6"></line><g class="step" transform="translate(5,120)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">char_sequence_create</tspan><tspan x="120" dy="18">(consider whitespace)</tspan></text></g><g class="step" transform="translate(5,250)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">myers_dp / myers_nd char diff</tspan></text></g><g class="step" transform="translate(5,380)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">optimize_sequence_diffs</tspan></text></g><g class="step" transform="translate(5,510)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">extend_diffs_to_entire_word</tspan><tspan x="120" dy="18">(+subword option)</tspan></text></g><g class="step" transform="translate(5,640)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">remove_short_matches</tspan></text></g><g class="step" transform="translate(5,770)"><rect width="240" height="90" rx="16" ry="16" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#ffffff"><tspan x="120" dy="0">remove_very_short_text</tspan></text></g><g class="step" transform="translate(5,900)"><rect width="240" height="90" rx="16" ry="16" fill="#ff7f0e" stroke="#c04e00" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#000000"><tspan x="120" dy="0">Translate to RangeMapping</tspan><tspan x="120" dy="18">(no hit_timeout propagation)</tspan></text></g><g class="step" transform="translate(5,1030)"><rect width="240" height="90" rx="16" ry="16" fill="#dddddd" stroke="#aaaaaa" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#333333"><tspan x="120" dy="0">Whitespace scan between</tspan><tspan x="120" dy="18">line segments</tspan></text></g><g class="step" transform="translate(5,1160)"><rect width="240" height="90" rx="16" ry="16" fill="#dddddd" stroke="#aaaaaa" stroke-width="2"></rect><text x="120" y="24" text-anchor="middle" font-size="15" fill="#333333"><tspan x="120" dy="0">compute_diff render plan</tspan><tspan x="120" dy="18">(DefaultLinesDiffComputer parity)</tspan></text></g></g><line x1="327" y1="165" x2="703" y2="165" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="327" y1="295" x2="703" y2="295" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="327" y1="425" x2="703" y2="425" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="327" y1="555" x2="703" y2="555" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="327" y1="685" x2="703" y2="685" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="165" x2="1023" y2="165" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="295" x2="1023" y2="295" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="425" x2="1023" y2="425" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="555" x2="1023" y2="555" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="685" x2="1023" y2="685" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><line x1="647" y1="815" x2="1023" y2="815" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6" marker-end="url(#parity-dot)"></line><path d="M195,730L195,760L515,760L515,108" fill="none" stroke="#555" stroke-width="2" marker-end="url(#arrow)"></path><path d="M835,730L835,760L1155,760L1155,108" fill="none" stroke="#555" stroke-width="2" marker-end="url(#arrow)"></path><g transform="translate(880, 1220)"><rect width="280" height="130" rx="16" ry="16" fill="#ffffff" stroke="#d0d7e5" stroke-width="2"></rect><rect x="20" y="16" width="24" height="18" rx="6" ry="6" fill="#1f77b4" stroke="#134a77" stroke-width="2"></rect><text x="60" y="28" alignment-baseline="middle" font-size="14" fill="#1f2d3d">Complete parity</text><rect x="20" y="38" width="24" height="18" rx="6" ry="6" fill="#ff7f0e" stroke="#c04e00" stroke-width="2"></rect><text x="60" y="50" alignment-baseline="middle" font-size="14" fill="#1f2d3d">Partial parity / needs refinement</text><rect x="20" y="60" width="24" height="18" rx="6" ry="6" fill="#dddddd" stroke="#aaaaaa" stroke-width="2"></rect><text x="60" y="72" alignment-baseline="middle" font-size="14" fill="#1f2d3d">Placeholder / not implemented</text><line x1="20" y1="90" x2="44" y2="90" stroke="#9aa5bc" stroke-width="2" stroke-dasharray="4,6"></line><text x="60" y="94" alignment-baseline="middle" font-size="14" fill="#1f2d3d">Dashed link = parity mapping</text><line x1="20" y1="112" x2="44" y2="112" stroke="#555" stroke-width="2" marker-end="url(#arrow)"></line><text x="60" y="116" alignment-baseline="middle" font-size="14" fill="#1f2d3d">Solid arrow = line ➜ char pipeline</text></g></svg>